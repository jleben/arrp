import signal;
import array;
import math;

input coefs_a : [2]real64;
input coefs_b : [3]real64;

delay(v,d,x) = [i | i < d -> v | x[i-d]];

convolve(h,x) =
  let f(w) = math.sum(h * array.reverse(w)) in
    array.map(f, signal.win(#h,1,x));

iir(aa,bs,x) = y where {
    y = convolve(bs, delay(0,#bs-1,x)) -
        convolve(aa, delay(0,#aa,y));
};

x = [t -> t];
output main = iir(coefs_a, coefs_b, x);

##? [~]real64
##? 0.000
##? 1.000
##? 1.500
##? 2.333
##? 3.083
##? 3.750
##? 4.542
##? 5.250
##? 5.979
##? 6.729
##? 7.448
##? 8.187
##? 8.922
##? 9.651
##? 10.388
##? 11.120
##? 11.853
##? 12.587
##? 13.320
##? 14.053
##? 14.787
##? 15.520
##? 16.253
##? 16.987
##? 17.720
